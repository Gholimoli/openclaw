name: work-ship
args:
  repo:
    description: "Repo name or owner/name"
  repoDir:
    description: "Resolved local repo directory"
  workctlPath:
    description: "Absolute path to workctl script"
  coderSessionKey:
    description: "Session key used for sandboxed exec via /tools/invoke"
  workRoot:
    description: "Base directory for repos"
  base:
    default: "main"
steps:
  - id: ensure_repo
    command: node "$workctlPath" ensure-repo --repo "$repo" --work-root "$workRoot" --base "$base" --session-key "$coderSessionKey" --json
  - id: approve_push
    command: node "$workctlPath" approve --prompt "Push branch + open PR for $repo?" --json
    approval: required
  - id: push_pr
    command: node "$workctlPath" push-pr --repo-dir "$repoDir" --base "$base" --session-key "$coderSessionKey" --json
    condition: $approve_push.approved
