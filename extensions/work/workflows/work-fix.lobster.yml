name: work-fix
args:
  repo:
    description: "Repo name or owner/name"
  repoDir:
    description: "Resolved local repo directory"
  workctlPath:
    description: "Absolute path to workctl script"
  coderSessionKey:
    description: "Session key used for sandboxed exec via /tools/invoke"
  workRoot:
    description: "Base directory for repos"
  base:
    default: "main"
  maxFixLoops:
    default: 3
steps:
  - id: ensure_repo
    command: node "$workctlPath" ensure-repo --repo "$repo" --work-root "$workRoot" --base "$base" --session-key "$coderSessionKey" --json
  - id: fix
    command: node "$workctlPath" fix --repo-dir "$repoDir" --base "$base" --max-fix-loops "$maxFixLoops" --session-key "$coderSessionKey" --json
